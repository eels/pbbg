www.{$APP_WEB_CLIENT_DOMAIN} {
  redir https://{$APP_WEB_CLIENT_DOMAIN}{uri} permanent
}

{$APP_WEB_CLIENT_DOMAIN} {
  log {
    output file /var/log/webapp.log
    format json
  }

  header -Server

  header Referrer-Policy "no-referrer-when-downgrade"

  header Strict-Transport-Security "max-age=31536000; includeSubDomains"

  header X-Content-Type-Options "nosniff"

  header X-Frame-Options "DENY"

  header X-XSS-Protection "1; mode=block"

  try_files {path}.html {path}

  encode zstd gzip

  push

  reverse_proxy web:{$PORT}
}

localhost:80 {
  reverse_proxy web:{$PORT}
}
